# GC23

Segmentation on images finding ice lakes in Greenland.

## Setup

1. Download the dataset from the official website, and put all files in `./raw`

2. Setup virtual environment for preprocessing

    ```
    conda env create -f env-preprocessing.yml
    ```

3. Docker image

    ```
    docker build --build-arg USER_ID=$UID -t detectron2 .
    ```

    or

    ```
    docker pull tumbgd/detectron2
    ```

 4. Run a docker container

    ```
    docker run --gpus device=0 -d -it --shm-size 32G --mount source=<code-src>,target=/home/appuser/gc23,type=bind tumbgd/detectron2
    docker exec -it <container-id> bash
    ```

## Steps

- `run1.py`:
    - split dataset (both images and ice lake polygons) by the given 6 region polygons.
    - preprocessing
        - cut image into tiles (1024 $\times$ 1024, step=512)
        - screen out tiles with too much blank (>=50%)
        - screen out tiles without blue pixels, as lakes are blue. (<0.01%, approx. 105 pixels)
        - screen out tiles without labels (this step is only applied to training area)
        - save tiles with or without labels
    - preparation for model training
        - transform polygons into detectron2-compatible json format
        - train-valid split

- `run2.py`:
    ```
    python run2.py
    python run2.py --retrain
    ```

TODO:

- Train a model to identify whether the input tile has a lake
- Train a segmentation model to obtain lakes
- Combine lakes at tile edges
- visualization
- remove `.xml` generated by qgis


## Discussion

- What about just select tiles according to the position of the lakes? too many pictures? always in the center (add some offset)?
- Do image segmentation models accept images without labels?
- How to connect lakes locate at the edge of tiles?
